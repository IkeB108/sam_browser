(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3479:(e,t,n)=>{Promise.resolve().then(n.bind(n,827))},827:(e,t,n)=>{"use strict";n.r(t),n.d(t,{calcUserHasPinchZoomed:()=>e_,default:()=>eV,useSessionStateStore:()=>eR,useUserSettingsStore:()=>eB,worksheets:()=>S});var o=n(1047),r=n(6847);let s=e=>{let t;let n=new Set,o=(e,o)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=o?o:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,s={setState:o,getState:r,getInitialState:()=>i,subscribe:e=>(n.add(e),()=>n.delete(e))},i=t=e(o,r,s);return s},i=e=>e?s(e):s,l=e=>e,a=e=>{let t=i(e),n=e=>(function(e,t=l){let n=r.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return r.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},d=e=>e?a(e):a;function u(e){let t=e.isShort?"10px":"14px",n={borderRadius:"200px",paddingTop:t,paddingBottom:t,paddingLeft:"24px",paddingRight:"24px",display:"flex",alignItems:"center",justifyContent:"center",border:e.isFilled?"none":"1px solid #3d3d3d",backgroundColor:e.isFilled?x.purpleColor:"white",color:e.isFilled?"white":"#3d3d3d",fontFamily:"Roboto, sans-serif",fontWeight:500,fontSize:"16px",cursor:"pointer",userSelect:"none"};e.additionalStyleObject&&Object.assign(n,e.additionalStyleObject);let r={...e};return(delete r.functionToTrigger,delete r.isFilled,delete r.isShort,delete r.additionalStyleObject,delete r.useOnClick,e.useOnClick)?(0,o.jsx)("button",{style:n,onClick:e.functionToTrigger,...r,children:e.children}):e.useOnClick?void 0:(0,o.jsx)(h,{style:n,functionToTrigger:e.functionToTrigger,...r,children:e.children})}function c(e){let{buttonWidthString:t,iconWidthString:n,color:r,onClickFunction:s,additionalStyleObject:i}=e,l={background:"none",border:"none",cursor:"pointer",padding:"0px",verticalAlign:"middle",display:"flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box"};t&&(l.width=t,l.height=t),i&&Object.assign(l,i);let a=null;return n&&(a={width:n,height:n}),(0,o.jsx)("button",{style:l,onClick:s,children:(0,o.jsx)("img",{src:"".concat(x.iconsFolderPath,"/close_").concat(r,".svg"),alt:"Close",style:a})})}function g(e){let{refSetting:t,widthSetting:n,heightSetting:r,children:s,additionalStyleObject:i,blockBehind:l}=e,a={position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:n,height:r,backgroundColor:"white",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.45)",zIndex:3,overflow:"auto",padding:"20px",borderRadius:"24px"};return(i&&Object.assign(a,i),l)?l?(0,o.jsx)("div",{style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"#00000055",zIndex:"3"},children:(0,o.jsx)("div",{ref:t||null,style:a,children:s})}):void 0:(0,o.jsx)("div",{ref:t||null,style:a,children:s})}function h(e){let t=(0,r.useRef)(null);e.functionToTrigger||console.error("PressDownButton requires a functionToTrigger prop"),e.onClick&&console.warn("PressDownButton is not meant to use onClick prop");let n=function(t){t.preventDefault(),e.functionToTrigger()};(0,r.useEffect)(()=>(t.current.addEventListener("mousedown",n),t.current.addEventListener("touchstart",n),()=>{t.current&&(t.current.removeEventListener("mousedown",n),t.current.removeEventListener("touchstart",n))}),[]);let s={...e};return delete s.functionToTrigger,(0,o.jsxs)("button",{ref:t,...s,children:[" ",e.children," "]})}let p="/sam_browser/out",x={softBorderColor:"#A9A09E",redColor:"#C56D61",purpleColor:"#55587B",nearBlackColor:"#3d3d3d",worksheetSelectionPanelWidth:"200px",colorMap:{red:"#BD1452",orange:"#FE9350",yellow:"#FFFB79",green:"#91D480",cyan:"#70D9FF",blue:"#2D4CA8",purple:"#8B2F99",pink:"#FF9FDC"},getGenericButtonStyle:function(e){return{padding:"10px",borderRadius:"8px",cursor:"pointer",borderColor:"black",borderStyle:"solid",...{primary:{backgroundColor:"black",color:"white",border:"none"},secondary:{backgroundColor:"white",color:"black"},tertiary:{backgroundColor:"transparent",color:"black",border:"none"}}[e]}},useBasePath:!0,basePathToUse:p,webWorkersFolderPath:p+"/web_workers_for_ws_images",iconsFolderPath:p+"/icons",idbDatabaseVersion:1},f=x.basePathToUse,S={};async function b(){try{let e=await fetch(f+"/worksheetsWithoutPageBlobs.json");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();Object.assign(S,t)}catch(e){return console.error("Error fetching worksheetsWithoutPageBlobs.json:",e),null}}function k(e){let t=x.idbDatabaseVersion,n=indexedDB.open("worksheetDatabase",t);n.onupgradeneeded=function(e){e.target.result.createObjectStore("allWorksheets")},n.onsuccess=async function(t){t.target.result.transaction("allWorksheets","readonly").objectStore("allWorksheets").get(e).onsuccess=async function(t){let n=t.target.result;void 0!==n&&n.hasOwnProperty("pageBlobs")&&(S[e]=n,U.setState({timeOfLastWorksheetAdd:Date.now()}))}}}let w=d(e=>({aWorksheetProcessIsBusy:!1,updateValue:t=>{e(()=>({aWorksheetProcessIsBusy:t}))}})),m=d(e=>({statusMessage:"",setStatusMessage:t=>{e(()=>({statusMessage:t}))}})),y=d(e=>({userHasPinchZoomed:!1,setUserHasPinchZoomed:t=>{e(()=>({userHasPinchZoomed:t}))}})),v=d(e=>({userJustClickedMove:!1})),j=d(e=>({addWorksheetModalIsOpen:!1,setAddWorksheetModalIsOpen:t=>{e(()=>({addWorksheetModalIsOpen:t}))},indexOfStudentAddingFor:null,setIndexOfStudentAddingFor:t=>{e(()=>({indexOfStudentAddingFor:t}))}})),W=d(e=>({searchInputValue:"",setSearchInputValue:t=>{["a","b","c","1","2","3","4","5","6","7"].includes(t.toLowerCase())&&(t="0"+t),e({searchInputValue:t});let n={0:0,"0a":0,"0b":0,"0c":0,"01":1,"02":2,"03":3,"04":4,"05":5,"06":6,"07":7};if(t.length>=2)I.getState().setSearchResults(B(t));else if("0"==t){let e=[...B("0a"),...B("0b"),...B("0c")];I.getState().setSearchResults(e)}else I.getState().setSearchResults([]);if(O.getState().setHighlightedResultIndex(0),"0"==t){C.getState().setSelectedLevelInteger("0");return}if(t.length>=2){let e=t.slice(0,2).toLowerCase();if(n.hasOwnProperty(e)){C.getState().setSelectedLevelInteger(n[e]);return}}"0"!==t&&C.getState().setSelectedLevelInteger("All")}})),C=d(e=>({selectedLevelInteger:"All",setSelectedLevelInteger:t=>e({selectedLevelInteger:t})})),I=d(e=>({searchResults:[],setSearchResults:t=>{e({searchResults:t}),e({resultElementRefs:[]})},resultElementRefs:[],setResultElementRefs:t=>e({resultElementRefs:t})})),O=d(e=>({highlightedResultIndex:0,setHighlightedResultIndex:t=>{e({highlightedResultIndex:t});let{resultElementRefs:n}=I.getState();n.length>0&&n[t].scrollIntoView({behavior:"instant",block:"nearest"})}}));function P(e){let t=!1,{searchResults:n}=I.getState();if(n.length>0){let{highlightedResultIndex:o}=O.getState(),r=o;"ArrowDown"==e.key&&(r++,e.preventDefault(),t=!0),"ArrowUp"==e.key&&(r--,e.preventDefault(),t=!0),r<0&&(r=n.length-1),r>=n.length&&(r=0),r!=o&&O.getState().setHighlightedResultIndex(r),"Enter"==e.key&&(z(),e.preventDefault(),t=!0)}t||document.querySelector("#searchInput").focus()}function D(){(0,r.useEffect)(()=>(W.getState().setSearchInputValue(""),document.addEventListener("keydown",P),window.useSelectedLevelStore=C,window.getSearchResults=B,window.searchResultsStore=I,window.useHighlightedResultIndexStore=O,()=>{document.removeEventListener("keydown",P)}),[]);let{indexOfStudentAddingFor:e}=j.getState(),{openStudents:t}=eR.getState(),n=t[e].name;return(0,o.jsxs)(g,{blockBehind:!0,widthSetting:"96%",heightSetting:"96%",additionalStyleObject:{boxSizing:"border-box",display:"flex",flexDirection:"column",maxWidth:"1000px",maxHeight:"700px"},children:[(0,o.jsxs)("div",{width:"100%",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[" ",(0,o.jsxs)("h1",{style:{fontFamily:"Roboto, sans-serif",fontSize:"18px",fontWeight:"normal",margin:"0"},children:["Add Worksheet for ",n]}),(0,o.jsx)(c,{buttonWidthString:"37px",iconWidthString:"22px",color:"black",onClickFunction:function(){j.getState().setAddWorksheetModalIsOpen(!1)},additionalStyleObject:{top:"10px",right:"10px"}})]}),(0,o.jsxs)("div",{style:{display:"flex",height:"100%"},children:[" ",(0,o.jsxs)("div",{style:{flexGrow:"1",boxSizing:"border-box",marginRight:"20px",display:"flex",flexDirection:"column",height:"100%",containerType:"size"},children:[(0,o.jsx)(L,{}),(0,o.jsx)(A,{}),(0,o.jsx)(T,{})]}),(0,o.jsx)(R,{})]})]})}function T(){let{searchResults:e}=I(),{highlightedResultIndex:t}=O(),n={width:"100%",padding:"10px 0px",borderBottom:"1px solid #D1C7C5",cursor:"pointer"},r={backgroundColor:"#EAE4D4",borderBottom:"1px solid #EAE4D4"};r={...r,...n};let s={borderTop:"1px solid #D1C7C5"};s={...s,...n};let i=e=>e==t?r:0==e?s:n,l=function(t){_(e[t],!0)},a=e=>{if(null==e)return;let{resultElementRefs:t}=I.getState();t.push(e)},d={overflowY:"auto",height:"100%",boxSizing:"border-box",marginTop:"20px"};return 0==e.length&&(d.alignContent="center",d.alignSelf="center"),(0,o.jsxs)("div",{style:d,children:[0==e.length?(0,o.jsx)("img",{src:x.iconsFolderPath+"/inputInstructions.svg",alt:"Input instructions: For book 3.24 DWR 1-3, enter 3.24, skip DWR, and enter 1-3",style:{width:"120px"}}):null,e.map((e,t)=>(0,o.jsx)("div",{onClick:()=>{l(t)},style:i(t),ref:a,children:e},t))]})}function L(){let{searchInputValue:e}=W();return(0,r.useEffect)(()=>{eR.getState().lastPointerInputWasTouch||document.getElementById("searchInput").focus()},[]),(0,o.jsxs)("div",{style:{width:"100%",height:"50px",flexShrink:"0",border:"1px solid #A9A09E",borderRadius:"200px",boxSizing:"border-box",marginTop:"20px",overflow:"hidden",display:"flex"},children:[(0,o.jsx)("input",{type:"text",placeholder:"Search a worksheet ID...",style:{color:"#3d3d3d",fontFamily:"Roboto, sans-serif",fontSize:"16px",width:"100%",height:"100%",border:"none",padding:"17px 24px",boxSizing:"border-box",outline:"none"},value:e,onChange:e=>{let t=e.target.value;W.getState().setSearchInputValue(t)},id:"searchInput",autoComplete:"off"}),(0,o.jsx)(c,{iconWidthString:"14px",color:"black",onClickFunction:function(){let{setSearchInputValue:e}=W.getState();e("")},additionalStyleObject:{width:60,height:"100%"}})]})}function A(){return(0,o.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"20px",flexWrap:"wrap"},children:[(0,o.jsx)(E,{levelInteger:"All"}),(0,o.jsx)(E,{levelInteger:"0"}),(0,o.jsx)(E,{levelInteger:"1"}),(0,o.jsx)(E,{levelInteger:"2"}),(0,o.jsx)(E,{levelInteger:"3"}),(0,o.jsx)(E,{levelInteger:"4"}),(0,o.jsx)(E,{levelInteger:"5"}),(0,o.jsx)(E,{levelInteger:"6"}),(0,o.jsx)(E,{levelInteger:"7"})]})}function E(e){let{levelInteger:t}=e,{selectedLevelInteger:n}=C(),r="Lvl "+t;"All"==t&&(r="All");let s={padding:"8px 12px",margin:"0",border:"2px solid #DAD6D5",fontWeight:"normal",fontSize:"16px"};return n==t&&(s.backgroundColor="#E6E6EB"),(0,o.jsx)(u,{isFilled:!1,isShort:!0,additionalStyleObject:s,functionToTrigger:()=>{C.getState().setSelectedLevelInteger(t),"All"==t?W.getState().setSearchInputValue(""):"0"==t?W.getState().setSearchInputValue("0"):W.getState().setSearchInputValue("0"+t)},children:r})}function F(e){let t,{val:n}=e,r={backgroundColor:"white",border:"1px solid #DAD6D5",boxShadow:"0px 1px 4px #0000001a",width:"50px",height:"50px",color:"#3D3D3D",borderRadius:"7px",fontFamily:"Roboto, sans-serif",fontSize:"30px",display:"flex",alignItems:"center",justifyContent:"center"},s=function(e){if("clear"==e){W.getState().setSearchInputValue("");return}if("backspace"==e){let{searchInputValue:e,setSearchInputValue:t}=W.getState();t(e.slice(0,-1));return}if("open"==e){z();return}let t=W.getState().searchInputValue;W.getState().setSearchInputValue(t+e)},i={width:"55px",height:"55px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:"white",border:"none",padding:"0px",userSelect:"none"};"backspace"==n?t=(0,o.jsx)("img",{src:x.iconsFolderPath+"/backspace.svg",alt:"Backspace",style:{width:"26px",height:"26px"}}):"clear"==n?(t="Clear",r.backgroundColor=x.redColor,r.color="white",r.fontSize="20px"):"open"==n?(t="Open",i.width="100px",r.width="100%",r.backgroundColor="#eae4d444",r.border="1px solid rgb(204, 194, 166)",r.fontSize="20px"):t=n;let l=!1;return"open"==n&&(l=0==I().searchResults.length),l&&(r.backgroundColor="#EBEBEB",r.border="none",r.color="#8c8c8c",i.cursor="not-allowed"),(0,o.jsx)(h,{style:i,functionToTrigger:()=>{s(n)},disabled:l,children:(0,o.jsx)("div",{style:r,children:t})})}function R(){let e={display:"flex",justifyContent:"center"};return(0,o.jsxs)("div",{style:{margin:"auto 0",justifyItems:"center"},children:[(0,o.jsxs)("div",{style:e,children:[(0,o.jsx)(F,{val:"A"}),(0,o.jsx)(F,{val:"B"}),(0,o.jsx)(F,{val:"C"})]}),(0,o.jsxs)("div",{style:e,children:[(0,o.jsx)(F,{val:"1"}),(0,o.jsx)(F,{val:"2"}),(0,o.jsx)(F,{val:"3"})]}),(0,o.jsxs)("div",{style:e,children:[(0,o.jsx)(F,{val:"4"}),(0,o.jsx)(F,{val:"5"}),(0,o.jsx)(F,{val:"6"})]}),(0,o.jsxs)("div",{style:e,children:[(0,o.jsx)(F,{val:"7"}),(0,o.jsx)(F,{val:"8"}),(0,o.jsx)(F,{val:"9"})]}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"center",marginBottom:"10px"},children:[(0,o.jsx)(F,{val:"backspace"}),(0,o.jsx)(F,{val:"0"}),(0,o.jsx)(F,{val:"clear"})]}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,o.jsx)(F,{val:"open"})})]})}function B(e){let t=e.toUpperCase().replace(/[^0-9A-Z]/gi,"");if(t.length<2)return[];let n=t.toUpperCase().slice(0,2).replace(/[^0-9ABC]/gi,"")+t.toUpperCase().slice(2).replace(/[^0-9]/gi,""),o=e.toUpperCase().replace(/[^A-Z]/gi,""),r=[],s=(e,t)=>{if(e.includes("(OLD)")&&!t.includes("(OLD)"))return 1;if(!e.includes("(OLD)")&&t.includes("(OLD)"))return -1;let n=e.toUpperCase().replace(/[^A-Z]/gi,"").includes(o),r=t.toUpperCase().replace(/[^A-Z]/gi,"").includes(o);return n&&!r?-1:!n&&r||e.includes("(USA)")&&!t.includes("(USA)")?1:!e.includes("(USA)")&&t.includes("(USA)")?-1:0};worksheets.integerMap[n]&&(r=worksheets.integerMap[n]),r.sort(s);let i=[];for(let e in worksheets.integerMap)e.startsWith(n)&&worksheets.integerMap[e].forEach(e=>{r.includes(e)||i.push(e)});return i.sort(s),[...r,...i]}function _(e,t){let n;let{indexOfStudentAddingFor:o}=j.getState(),{openStudents:r,setCurrentPageOfWorksheet:s,setCurrentWorksheet:i}=eR.getState(),l=r[o],a=function(e,t){for(let n in t)if(t[n].id==e)return n;return null}(e,l.openWorksheets),d=null;null==a?(d="single"==eB.getState().pageView?1:0,l.openWorksheets.push({id:e,pageLeftOff:d,notes:""}),n=l.openWorksheets.length-1):n=a,i(o,n),null!==d&&s(d),t&&j.getState().setAddWorksheetModalIsOpen(!1)}function z(){let{searchResults:e}=I.getState();if(0==e.length)return;let{highlightedResultIndex:t}=O.getState();_(e[t],!0)}let M=d(e=>({isFullscreen:!1})),N=d(e=>({pagesAreHidden:!1,setPagesAreHidden:t=>e({pagesAreHidden:t})})),V=d(e=>({userIsDraggingPages:!1,touchStartX:null,currentPageOnTouchStart:null,currentGestureIncludesMultitouch:!1})),U=d(e=>({timeOfLastWorksheetAdd:null})),H=function(){let{userHasPinchZoomed:e}=y.getState(),{pagesAreHidden:t}=N.getState(),{currentWorksheet:n}=eR.getState(),{currentGestureIncludesMultitouch:o}=V.getState();return!e&&!t&&null!=n.worksheetIndex&&!o},G={prevPage:["d","ArrowLeft"],nextPage:["f","ArrowRight"],prevWorksheet:["a","ArrowUp"],nextWorksheet:["s","ArrowDown"],prevStudent:["e"],nextStudent:["r"],addWorksheetNote:["t"],addStudentNote:["g"],addWorksheet:["w"],addStudent:["x"],renameStudent:["z"],copyOneWorksheet:["c"],copyStudent:["v"]};function Z(e){let{allowArrowKeysForPageNavigation:t}=eR.getState(),n=function(e){for(let t in G)if(G[t].includes(e))return t;return null}(e.key);if(t&&"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&null!==n){let{openStudentIndex:t,worksheetIndex:o}=eR.getState().currentWorksheet;switch(n){case"prevPage":er("prev");break;case"nextPage":er("next");break;case"prevWorksheet":J("prev");break;case"nextWorksheet":J("next");break;case"nextStudent":X("next");break;case"prevStudent":X("prev");break;case"addWorksheetNote":document.getElementById("notes-about-worksheet-text-area")&&(document.getElementById("notes-about-worksheet-text-area").focus(),e.preventDefault());break;case"addStudentNote":let r=document.getElementById("worksheetSelectionPanelChildDiv").children[t];r.getElementsByTagName("textarea")[0]&&(r.getElementsByTagName("textarea")[0].focus(),e.preventDefault());break;case"addWorksheet":ej(t),e.preventDefault();break;case"addStudent":eW();break;case"renameStudent":ep(t);break;case"copyOneWorksheet":!function(e,t){let{openStudents:n}=eR.getState(),o=n[e];if(!o.openWorksheets[t])return;let r=ew(o.openWorksheets[t].id);o.openWorksheets[t].notes.length>0&&(r+=" (".concat(o.openWorksheets[t].notes,")")),navigator.clipboard.writeText(r)}(t,o);break;case"copyStudent":ek(t)}}}function X(e){let{currentWorksheet:t,openStudents:n}=eR.getState();n[t.openStudentIndex];let{worksheetIndex:o,openStudentIndex:r}=t,s="same";if("next"==e&&(n.length>r+1?s=r+1:0!==r&&(s=0)),"prev"==e&&(r>0?s=r-1:r!==n.length-1&&(s=n.length-1)),"same"!==s){let e=n[s],t=e.indexOfLastWorksheetOpen;if(void 0!==e.openWorksheets[t])eR.getState().setCurrentWorksheet(s,t);else{let t=e.openWorksheets.length>0?0:null;eR.getState().setCurrentWorksheet(s,t)}K(s)}}function J(e){let{currentWorksheet:t,openStudents:n}=eR.getState(),o=n[t.openStudentIndex],{worksheetIndex:r,openStudentIndex:s}=t,i="same";if("next"==e){if(o.openWorksheets.length>r+1)eR.getState().setCurrentWorksheet(s,r+1);else if(n.length>s+1){let e=n[s+1].openWorksheets.length>0?0:null;eR.getState().setCurrentWorksheet(s+1,e),i=s+1}else{let e=n[0].openWorksheets.length>0?0:null;eR.getState().setCurrentWorksheet(0,e),i=0}}if("prev"==e){if(r>0)eR.getState().setCurrentWorksheet(s,r-1);else if(s>0){let e=n[s-1].openWorksheets.length-1;-1==e&&(e=null),eR.getState().setCurrentWorksheet(s-1,e),i=s-1}else{i=n.length-1;let e=n[i].openWorksheets.length-1;-1==e&&(e=null),eR.getState().setCurrentWorksheet(i,e)}}"same"!==i&&K(i)}function K(e){document.getElementById("worksheetSelectionPanelChildDiv").children[e].scrollIntoView({behavior:"instant"})}function Y(e){if(!H())return;e.preventDefault();let t=e.touches?e.touches[0].clientX:e.clientX;V.setState({userIsDraggingPages:!0,currentPageOnTouchStart:eR.getState().currentPageOfWorksheet,touchStartX:t})}function $(e){e.touches.length>1&&V.setState({currentGestureIncludesMultitouch:!0})}function q(e){0==e.touches.length&&V.setState({currentGestureIncludesMultitouch:!1})}function Q(e){let{userIsDraggingPages:t,touchStartX:n,currentPageOnTouchStart:o}=V.getState();if(!t||!H())return;let{setCurrentPageOfWorksheet:r,getCurrentWorksheetID:s}=eR.getState();if(void 0===S[s()])return;e.preventDefault();let i=-1*Math.round(((e.touches?e.touches[0].clientX:e.clientX)-n)/60),{pageView:l}=eB.getState();"double"==l&&(i*=2);let a=o+i,d="single"==l?1:0,u=S[s()].pageCount;"double"==l&&u%2==1&&(u-=1),a<d&&(a=d),a>u&&(a=u);let{currentPageOfWorksheet:c}=eR.getState();a!==c&&r(a)}function ee(e){let{userIsDraggingPages:t,currentGestureIncludesMultitouch:n}=V.getState();if(t&&!n){e.preventDefault(),document.getElementById("notes-about-worksheet-text-area").blur();let t=document.getElementsByClassName("notes-text-area");for(let e=0;e<t.length;e++)t[e].blur();V.setState({userIsDraggingPages:!1,currentPageOnTouchStart:null,touchStartX:null,currentGestureIncludesMultitouch:!1})}}function et(){document.body.requestFullscreen(),M.setState({isFullscreen:!0})}function en(){document.exitFullscreen(),M.setState({isFullscreen:!1})}function eo(){let e=w().aWorksheetProcessIsBusy,t=m().statusMessage,{pageView:n}=eB(),r=null,s={width:"100%",height:"100%",containerType:"size",boxSizing:"border-box",display:"flex"};return e?r=(0,o.jsx)("div",{id:"wrapper-for-both-pages",style:s,children:(0,o.jsx)("p",{style:{height:"30px"},children:t})}):("double"==n&&(r=(0,o.jsxs)("div",{id:"wrapper-for-both-pages",style:s,children:[(0,o.jsx)("div",{id:"wrapper-for-single-page",style:{position:"relative",width:"50%",height:"100%"},children:(0,o.jsx)(el,{isLeftOrRight:"left"})}),(0,o.jsx)("div",{id:"wrapper-for-single-page",style:{position:"relative",width:"50%",height:"100%"},children:(0,o.jsx)(el,{isLeftOrRight:"right"})})]})),"single"==n&&(r=(0,o.jsx)("div",{id:"wrapper-for-both-pages",style:s,children:(0,o.jsx)("div",{id:"wrapper-for-single-page",style:{position:"relative",width:"100%",height:"100%"},children:(0,o.jsx)(el,{isLeftOrRight:"left"})})}))),(0,o.jsxs)("div",{style:{flexGrow:1,flexBasis:"0%",height:"100%",padding:"16px",paddingRight:"8px",boxSizing:"border-box",display:"flex",flexDirection:"column",containerType:"size"},children:[r,(0,o.jsx)(es,{})]})}function er(e){let{currentPageOfWorksheet:t,setCurrentPageOfWorksheet:n,getCurrentWorksheetID:o}=eR.getState();if(null==o())return;let{pageView:r}=eB.getState(),s="single"==r?1:2,i=o();if(void 0===S[i])return;let l=t;"prev"==e&&(l-=s),"next"==e&&(l+=s);let a="single"==r?1:0,d=S[i].pageCount;"double"==r&&d%2==1&&(d-=1),l<a&&(l=a),l>d&&(l=d),n(l)}function es(){let{isFullscreen:e}=M(),{pageView:t}=eB(),n=x.iconsFolderPath+("single"==t?"/single_page_view.svg":"/two_page_view.svg"),r=(0,o.jsx)(u,{isFilled:!0,isShort:!0,additionalStyleObject:{paddingLeft:"min(1.5vw, 24px)",paddingRight:"min(1.5vw, 24px)",minWidth:"45px"},functionToTrigger:function(){let{pageView:e,setPageView:t}=eB.getState(),n="double"==e?"single":"double";t(n);let{currentPageOfWorksheet:o,setCurrentPageOfWorksheet:r}=eR.getState(),s=o;"single"==n&&0==s&&(s=1),"double"==n&&s%2==1&&s--,r(s)},children:(0,o.jsx)("img",{src:n,alt:"Toggle Page View"})}),s=(0,o.jsxs)(u,{isFilled:!1,isShort:!0,additionalStyleObject:{paddingLeft:"min(1.5vw, 24px)",paddingRight:"min(1.5vw, 24px)"},functionToTrigger:ev,useOnClick:!0,children:[(0,o.jsx)("p",{style:{margin:"0",padding:"0",marginRight:"10px",fontSize:"min(1.6vw, 16px)",textWrap:"nowrap"},children:"Move"}),(0,o.jsx)("img",{src:x.iconsFolderPath+"/move.svg",alt:"Move",style:{width:"19px",height:"15px"}})]});()=>{console.log("log worksheet button clicked")},x.iconsFolderPath;let{pagesAreHidden:i}=N(),l=(0,o.jsx)(u,{isFilled:!0,isShort:!0,additionalStyleObject:{paddingLeft:"min(2vw, 30px)",paddingRight:"min(2vw, 30px)"},functionToTrigger:function(){let{pagesAreHidden:e,setPagesAreHidden:t}=N.getState();t(!e)},children:i?(0,o.jsx)("img",{id:"toggle-hidden",src:x.iconsFolderPath+"/hidden.svg",alt:"Toggle visibility"}):(0,o.jsx)("img",{id:"toggle-visible",src:x.iconsFolderPath+"/visible.svg",alt:"Toggle visibility"})}),a=(0,o.jsx)(u,{isFilled:!0,isShort:!0,additionalStyleObject:{paddingLeft:"min(2vw, 30px)",paddingRight:"min(2vw, 30px)"},functionToTrigger:()=>{document.fullscreenElement?en():et()},children:e?(0,o.jsx)("img",{src:x.iconsFolderPath+"/fullscreen_exit.svg",alt:"Toggle Fullscreen"}):(0,o.jsx)("img",{src:x.iconsFolderPath+"/fullscreen.svg",alt:"Toggle Fullscreen"})}),d=(0,o.jsx)(u,{isFilled:!1,isShort:!0,additionalStyleObject:{paddingLeft:"min(2vw, 30px)",paddingRight:"min(2vw, 30px)",zIndex:"2"},functionToTrigger:()=>{er("prev")},children:(0,o.jsx)("img",{src:x.iconsFolderPath+"/arrow_left.svg",alt:"Previous Page",style:{width:"15px",height:"20px"}})}),c=(0,o.jsx)(u,{isFilled:!1,isShort:!0,additionalStyleObject:{paddingLeft:"min(2vw, 30px)",paddingRight:"min(2vw, 30px)",zIndex:"2"},functionToTrigger:()=>{er("next")},children:(0,o.jsx)("img",{src:x.iconsFolderPath+"/arrow_right.svg",alt:"Next Page",style:{width:"15px",height:"20px"}})});return(0,o.jsxs)("div",{style:{paddingTop:"16px",display:"flex"},children:[(0,o.jsxs)("div",{style:{display:"flex",gap:"8px",flexGrow:1,marginRight:"8px"},children:[a,r,l,s,(0,o.jsx)(ei,{})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[d,c]})]})}function ei(){let e=eR(e=>e.currentWorksheet),t=eR(e=>e.openStudents),n=eR(e=>e.getCurrentWorksheetID)();if(null==n)return null;let r=t[e.openStudentIndex].openWorksheets[e.worksheetIndex].notes;return(0,o.jsx)("input",{type:"text",style:{width:"100%",maxWidth:"500px",height:"100%",border:"1px solid #A9A09E",borderRadius:"8px",boxSizing:"border-box",resize:"none",fontSize:"12px",fontFamily:"Roboto, sans-serif",padding:"12px"},placeholder:"Notes for ".concat(n,"..."),value:r,onChange:function(n){let o=[...t];o[e.openStudentIndex].openWorksheets[e.worksheetIndex].notes=n.target.value,eR.getState().setOpenStudents(o)},onKeyDown:function(e){("Enter"==e.key||"`"==e.key||"Escape"==e.key)&&document.getElementById("notes-about-worksheet-text-area").blur()},id:"notes-about-worksheet-text-area",autoComplete:"off"})}function el(e){let{isLeftOrRight:t}=e;U();let n=(0,r.useRef)(null);(0,r.useEffect)(()=>(n.current.addEventListener("pointerdown",Y),()=>{n.current&&n.current.removeEventListener("pointerdown",Y)}),[]);let s=y(e=>e.userHasPinchZoomed),i=N(e=>e.pagesAreHidden),l=eR(e=>e.currentWorksheet),a=V(e=>e.currentGestureIncludesMultitouch),d=!s&&!i&&null!=l.worksheetIndex&&!a,{currentPageOfWorksheet:u,getCurrentWorksheetID:c}=eR(),g="left"==t?u:u+1,h=null,p=c();return p&&(eR.getState().usePlaceholderImages?h="use_placeholder_images":S[p]&&S[p].pageBlobs?S[p].pageBlobs[g]&&(h=S[p].pageBlobs[g]):h="worksheet_not_available"),(0,o.jsxs)("div",{style:{position:"absolute",inset:0,marginLeft:"auto",maxHeight:"100%",aspectRatio:"496 / 702",cursor:d?"ew-resize":"default",userSelect:"none"},ref:n,children:[(0,o.jsx)(ed,{pageImageBlob:h,pageNumber:g}),(0,o.jsx)(ea,{isLeftOrRight:t,pageNumber:g,pageExists:null===h})]})}function ea(e){let{isLeftOrRight:t,pageNumber:n,pageExists:r}=e,s={position:"absolute",bottom:"15px",width:"38px",height:"38px",backgroundColor:"white",borderRadius:"4px",border:"1px solid #3D3D3D",justifyContent:"center",alignItems:"center",fontSize:"18px",display:r?"none":"flex"};return s[t]="15px",(0,o.jsx)("div",{style:s,children:n})}function ed(e){let t,{pageImageBlob:n,pageNumber:r}=e,s={width:"100%",height:"100%",border:"1px solid #A9A09E",borderRadius:"12px",backgroundColor:"white",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",boxSizing:"border-box"},{pagesAreHidden:i}=N();return null===n||i||"worksheet_not_available"===n||0===r?(0,o.jsx)("div",{style:s}):(t="use_placeholder_images"==n?(x.useBasePath?x.basePathToUse:"")+"/placeholder_images/placeholder_image_".concat((r-1)%5+1,".webp"):URL.createObjectURL(n),(0,o.jsx)("img",{src:t,style:s,draggable:!1,onDragStart:e=>e.preventDefault()}))}function eu(){let e={width:x.worksheetSelectionPanelWidth,height:"100%",padding:"16px",paddingLeft:"8px",boxSizing:"border-box",overflowY:"scroll",containerType:"size"},t=eR().openStudents;return(0,r.useEffect)(()=>{window.openStudents=t},[]),(0,o.jsxs)("div",{style:{height:"100%",flexGrow:0,flexBasis:"0%",display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:e,id:"worksheetSelectionPanelChildDiv",children:[t.map((e,t)=>(0,o.jsx)(eg,{index:t},t)),(0,o.jsx)(eI,{})]}),(0,o.jsx)(ec,{})]})}function ec(){let e=(0,o.jsx)(u,{isFilled:!1,isShort:!0,additionalStyleObject:{paddingLeft:"min(1.5vw, 30px)",paddingRight:"min(1.5vw, 30px)"},functionToTrigger:()=>{eR.getState().setCurrentPage("SettingsPage")},children:(0,o.jsx)("img",{src:x.iconsFolderPath+"/settings.svg",alt:"Settings",style:{width:"23px",height:"23px"}})});return(0,o.jsx)("div",{style:{paddingTop:"16px",display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"16px",marginRight:"16px",borderTop:"1px solid #A9A09E"},children:e})}function eg(e){let{index:t}=e,n=eR(e=>e.openStudents)[t],r="other"==n.type,s=eR(e=>e.currentWorksheet.openStudentIndex)==t,i={width:"100%",backgroundColor:"white",borderRadius:"12px",boxShadow:"0px 1px 2px rgba(0, 0, 0, 0.45)",boxSizing:"border-box",marginBottom:"12px",overflow:"hidden",position:"relative"};return"other"==n.type&&(i.border="1px solid #eeeeee"),s&&(i.border="2px solid ".concat(x.softBorderColor)),(0,o.jsxs)("div",{style:i,id:"studentSessionCard_"+t,children:[(0,o.jsx)(eh,{index:t,studentName:n.name}),(0,o.jsx)(em,{index:t}),(0,o.jsx)(ex,{index:t,studentIsOther:r})]})}function eh(e){let{studentName:t,index:n}=e,{userIsMovingCurrentWorksheet:r,openStudents:s,currentWorksheet:i}=eR.getState(),l=eB(e=>e.madisonMode),a=s[n],d={display:"flex",alignItems:"center",backgroundColor:l?"#1ab0cb":x.redColor,padding:"6px 10px","--original-bg-color":x.redColor,"--pulsate-bg-color":"#eb9286"};r&&(d.cursor="pointer");let u={margin:0,whiteSpace:"nowrap",color:"white",fontWeight:"normal",fontSize:"12px",userSelect:"none",cursor:"pointer",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},g={width:"18px",height:"18px",borderRadius:"50%",backgroundColor:x.colorMap[a.color],marginRight:"10px"};"other"==a.type&&(g.backgroundColor="#00000000",d.backgroundColor="white",d.padding="10px 10px",d["--original-bg-color"]="rgb(223, 223, 223)",d["--pulsate-bg-color"]="white",u.color="black",delete u.cursor);let h=(0,o.jsx)(c,{buttonWidthString:"24px",iconWidthString:"14px",color:"white",onClickFunction:()=>{if(confirm("Remove "+a.name+" from the session?")){let{deleteOpenStudent:e}=eR.getState();e(n)}}}),p=s[n].notesCopied,f=(0,o.jsx)(eb,{index:n,hasCopied:p});return"other"==a.type&&(h=(0,o.jsx)(ef,{index:n})),r&&(h=(0,o.jsx)("div",{style:{width:"24px",height:"24px"}}),f=(0,o.jsx)("div",{style:{width:"24px",height:"24px"}})),"other"==a.type&&(f=null),(0,o.jsxs)("div",{style:d,className:r?"pulsatingHeader":null,onClick:r?function(){let{setOpenStudents:e,setCurrentWorksheet:t}=eR.getState();if(n!==i.openStudentIndex){let o=[...s];o[n].openWorksheets.push(s[i.openStudentIndex].openWorksheets[i.worksheetIndex]),s[i.openStudentIndex].openWorksheets.splice(i.worksheetIndex,1),e(o),t(n,o[n].openWorksheets.length-1)}}:null,children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",flexGrow:1,containerType:"size"},className:"left-container-for-student-header",children:[f,(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{style:u,onClick:"other"==a.type?null:function(){eR.getState().userIsMovingCurrentWorksheet||ep(n)},children:t}),p?(0,o.jsx)("p",{style:{margin:"0",fontSize:"12px",color:"#ffd3d3"},children:"Copied"}):null]})]}),(0,o.jsx)("div",{style:{display:"flex",alignItems:"center"},children:h})]})}function ep(e){let{openStudents:t}=eR.getState(),n=t[e];if("other"==n.type)return;let o=prompt("Enter new name for ".concat(n.name,":"));if(null!==o&&o.trim().length>0){let n=[...t];n[e].name=o,eR.getState().setOpenStudents(n)}}function ex(e){let{index:t,studentIsOther:n}=e,r={backgroundColor:"white",border:"2px solid ".concat(x.softBorderColor),borderRadius:"50%",cursor:"pointer",width:"40px",height:"40px",verticalAlign:"middle",display:"flex",alignItems:"center",justifyContent:"center"};return(0,o.jsxs)("div",{style:{padding:"10px 6px",paddingTop:"0px"},children:[(0,o.jsx)(eS,{index:t,studentIsOther:n}),(0,o.jsx)("div",{style:{backgroundColor:"none",justifyContent:"flex-end",alignItems:"center",display:"flex"},children:(0,o.jsx)(eC,{styleObject:r,index:t})})]})}function ef(e){let{index:t}=e;return(0,o.jsx)("button",{style:{width:"24px",height:"24px",backgroundColor:"#00000000",border:"none",cursor:"pointer",padding:"0px",verticalAlign:"middle",display:"flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box"},onClick:function(){if(!confirm("Clear all worksheets from 'Other'?"))return;let e=[...eR.getState().openStudents];e[t].openWorksheets=[],eR.getState().setOpenStudents(e),eR.getState().currentWorksheet.openStudentIndex==t&&eR.getState().setCurrentWorksheet(null,null)},children:(0,o.jsx)("img",{src:"".concat(x.iconsFolderPath,"/trash.svg"),alt:"Clear",style:{width:"20px"}})})}function eS(e){let{index:t,studentIsOther:n}=e,r=eR(e=>e.openStudents);return n?null:(0,o.jsx)("textarea",{style:{width:"100%",height:"40px",border:"1px solid #A9A09E",borderRadius:"8px",padding:"4px",boxSizing:"border-box",resize:"none",fontSize:"12px",fontFamily:"Roboto, sans-serif"},placeholder:"Notes...",value:r[t].notes,onChange:function(e){let n=[...r];n[t].notes=e.target.value,eR.getState().setOpenStudents(n)},className:"notes-text-area",onKeyDown:function(e){if("Enter"==e.key||"`"==e.key||"Escape"==e.key){let e=document.getElementsByClassName("notes-text-area");for(let t=0;t<e.length;t++)e[t].blur()}}})}function eb(e){let{index:t,hasCopied:n}=e;return(0,o.jsx)("button",{style:{width:"24px",height:"24px",backgroundColor:"#00000000",cursor:"pointer",padding:"0px",verticalAlign:"middle",display:"flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box",marginRight:"5px",border:"none"},onClick:function(){ek(t)},children:(0,o.jsx)("img",{src:"".concat(x.iconsFolderPath,"/").concat(n?"copied.svg":"copy.svg"),alt:"Copy",style:{width:n?"16px":"14px"}})})}function ek(e){let t="",{openStudents:n}=eR.getState(),o=n[e];for(let e=0;e<o.openWorksheets.length;e++){let n=ew(o.openWorksheets[e].id);o.openWorksheets[e].notes.length>0&&(n+=" (".concat(o.openWorksheets[e].notes,")")),e>0&&(n="\n"+n),t+=n}if(o.notes&&o.notes.length>0&&(t+="\n"+o.notes),0==(t=(t=t.replaceAll("$$","✅ prev HW")).replaceAll("##","❌ prev HW")).length){alert("No data to copy.");return}navigator.clipboard.writeText(t).then(()=>{});let r=[...n];r[e].notesCopied=!0,eR.getState().setOpenStudents(r)}function ew(e){let t=e.replace(/ WS$/,"").split(" "),n=[],o=[".","-","("],r=["HF","TP"],s=e=>{for(let t in o)if(e.includes(o[t]))return!0;for(let t in r)if(e==r[t])return!0;return!1};for(let e=0;e<t.length;e++){let o=t[e].toUpperCase();s(o)&&("(OLD)"==o&&(o="⌛"),"(USA)"==o&&(o="(usa)"),n.push(o))}return n.join(" ")}function em(e){let{index:t}=e,{openStudents:n,currentWorksheet:r}=eR(),s=n[t],i={display:"flex",flexDirection:"column",paddingTop:"10px",paddingBottom:"10px",paddingLeft:"6px",paddingRight:"6px",overflowY:"auto",height:"100%"};"other"==s.type&&(i.paddingTop="0px");let l=[];for(let e=0;e<s.openWorksheets.length;e++){let n=s.openWorksheets[e].id,i=r.openStudentIndex==t&&r.worksheetIndex==e,a=function(){let{setCurrentWorksheet:n,setUserIsMovingCurrentWorksheet:o}=eR.getState();n(t,e),o(!1)};l.push((0,o.jsx)(ey,{worksheetID:n,isCurrentWorksheet:i,onClick:a,notes:s.openWorksheets[e].notes},e))}return 0==l.length&&(l="No worksheets open",i.justifyContent="center",i.alignItems="center",i.fontSize="14px",i.color="#A9A09E"),(0,o.jsx)("div",{style:i,children:l})}function ey(e){let{worksheetID:t,isCurrentWorksheet:n,onClick:r,notes:s}=e,i={fontFamily:"Roboto, sans-serif",fontWeight:"normal",fontSize:"12px",border:"none",backgroundColor:"white",padding:"6px",cursor:n?"arrow":"pointer",textAlign:"left",width:"100%",borderRadius:"12px",color:"inherit",boxSizing:"border-box",display:"flex",justifyContent:"space-between",alignItems:"center"},l={margin:0,whiteSpace:n?"normal":"nowrap",overflow:"hidden",textOverflow:"ellipsis",flexShrink:1},a={fontSize:"12px",margin:"0",fontStyle:"italic",color:"#858585"},d=t.replace(/( WS|WS)$/,"");return n?(i.backgroundColor="#55587B26",(0,o.jsxs)("div",{style:i,children:[(0,o.jsxs)("div",{style:{width:"100%"},children:[(0,o.jsx)("p",{style:l,children:d}),s.length>0?(0,o.jsx)("p",{style:a,children:s}):null]}),(0,o.jsx)("div",{style:{display:"flex"},children:(0,o.jsx)(c,{buttonWidthString:"24px",iconWidthString:"14px",color:"black",onClickFunction:function(){let e=eR.getState().currentWorksheet,t=eR.getState().openStudents[e.openStudentIndex];t.openWorksheets.splice(e.worksheetIndex,1),t.indexOfLastWorksheetOpen=null,eR.getState().setCurrentWorksheet(e.openStudentIndex,null),eR.getState().setUserIsMovingCurrentWorksheet(!1),eR.getState().saveToLocalStorage()},additionalStyleObject:{flexShrink:0}})})]})):(0,o.jsx)("button",{style:i,onClick:r,children:(0,o.jsxs)("div",{style:{width:"100%"},children:[(0,o.jsx)("p",{style:l,children:d}),s.length>0?(0,o.jsx)("p",{style:a,children:s}):null]})})}function ev(){let{userIsMovingCurrentWorksheet:e,setUserIsMovingCurrentWorksheet:t,setUserCanClickAnywhereToDisableMovingCurrentWorksheet:n,currentWorksheet:o}=eR.getState();null!==o.openStudentIndex&&(e||(n(!0),v.setState({userJustClickedMove:!0}),setTimeout(()=>{v.setState({userJustClickedMove:!1})},100)),t(!e))}function ej(e){j.getState().setAddWorksheetModalIsOpen(!0),j.getState().setIndexOfStudentAddingFor(e)}function eW(){let{currentWorksheet:e,openStudents:t,numberInNameOfLastStudentAdded:n}=eR.getState(),o=Number(n)+1;o=o.toString(),1==t.length&&(o="1"),eR.setState(e=>({numberInNameOfLastStudentAdded:o})),eR.getState().addOpenStudentToBottom("Student "+o,"green"),eR.getState().setCurrentWorksheet(t.length-1,null),K(t.length-1)}function eC(e){let{styleObject:t,index:n}=e;return(0,o.jsx)("button",{style:t,onClick:function(){ej(n)},children:(0,o.jsx)("img",{src:x.iconsFolderPath+"/add_black.svg",alt:"Add worksheet",style:{width:"16px",height:"16px"}})})}function eI(){return(0,o.jsxs)(u,{useOnClick:!0,isFilled:!0,isShort:!0,functionToTrigger:eW,additionalStyleObject:{margin:"0 auto",paddingLeft:"15px",paddingRight:"15px"},id:"add-student-button",children:[(0,o.jsx)("img",{src:x.iconsFolderPath+"/add_white.svg",alt:"Add student",style:{width:"12px",height:"12px",marginRight:"8px"}}),(0,o.jsx)("p",{style:{margin:"0",padding:"0"},children:"Add Student"})]})}function eO(e){m.getState().setStatusMessage(e)}function eP(){return(0,o.jsx)(u,{isFilled:!1,functionToTrigger:function(){localStorage.removeItem("sessionState"),window.location.reload()},children:"\uD83D\uDD04 Reset Session"})}function eD(){let e=eB(e=>e.madisonMode);return(0,o.jsxs)(u,{isFilled:!1,functionToTrigger:()=>{let e=!eB.getState().madisonMode;eB.getState().setMadisonMode(e)},children:["\uD83D\uDC6D Madison & Yeju Mode: ",e?"ON":"OFF"]})}function eT(){x.getGenericButtonStyle("primary");let e=r.useRef(null),t=w().aWorksheetProcessIsBusy,n=async function(e){if(0===e.target.files.length)return;let t=e.target.files[0];(function(e){for(let t in e){let n=t.split("_-")[0],o=Number(t.split("_-")[1].split(".")[0]);if(S[n])void 0===S[n].pageBlobs&&(S[n].pageBlobs={}),S[n].pageBlobs[o]=e[t].blob;else{let r={};r[o]=e[t].blob,S[n]={pageBlobs:r,is_old:t.includes("(OLD)"),localization:t.includes("(USA)")?"USA":"only",pageCount:"unknown"}}}(function(){for(let e in S)"only"==S[e].localization&&function(e){let t=e.replace(/\D/g,"");for(let e in S){let n=e.replace(/\D/g,"");if(e.includes("(USA)")&&n==t)return!0}return!1}(e)&&(S[e].localization="NON-USA"),S[e].pageBlobs&&!["keys","integerMap"].includes(e)&&(S[e].pageCount=Object.keys(S[e].pageBlobs).length)})()})(await eL(t)),function(){let e=new Worker(x.webWorkersFolderPath+"/worker_for_store_files_in_idb.js"),t={worksheets:S,idbDatabaseVersion:x.idbDatabaseVersion};e.postMessage(t),e.onmessage=function(e){"status_update_from_web_worker"==e.data.type&&eO(e.data.content),"confirm_transaction_complete"==e.data.type&&w.getState().updateValue(!1)},w.getState().updateValue(!0)}()};return(0,o.jsxs)("div",{children:[(0,o.jsx)(u,{isFilled:!1,functionToTrigger:()=>{if(!w.getState().aWorksheetProcessIsBusy)try{e.current.click()}catch(e){alert(e)}},disabled:t,className:"button-with-disabled-variant",useOnClick:!0,children:"\uD83D\uDCE4 Upload Worksheet Image Data"}),(0,o.jsx)("input",{type:"file",style:{display:"none"},ref:e,accept:".tar",onChange:n})]})}async function eL(e){eO("Extracting images from tar file. This may take a minute...");let t=new FileReader,n={},o=0;return new Promise((r,s)=>{t.onload=function(e){untar(t.result).then(function(e){for(let t in e){let r=e[t].name.substring(e[t].name.lastIndexOf("/")+1);if(r.includes(".webp")){let s={name:r,blob:new Blob([e[t].blob],{type:"image/webp"}),size:e[t].size};n[r]=s,o++}else console.log("File not a webp image: "+r)}eO(o+" images extracted. Storing worksheets in your browser's cache. This may take a minute..."),r(n)}).catch(s)},t.onerror=s,t.readAsArrayBuffer(e)})}function eA(){x.getGenericButtonStyle("primary");let e=w().aWorksheetProcessIsBusy;return(0,o.jsx)(u,{isFilled:!1,functionToTrigger:function(){if(!w.getState().aWorksheetProcessIsBusy&&confirm("Are you sure you want to clear all worksheet image data?")){let e;(e=indexedDB.open("worksheetDatabase",x.idbDatabaseVersion)).onupgradeneeded=function(e){e.target.result.createObjectStore("allWorksheets")},e.onsuccess=async function(e){e.target.result.transaction("allWorksheets","readwrite").objectStore("allWorksheets").clear()},eO("Worksheet image data cleared.")}},disabled:e,className:"button-with-disabled-variant",children:"\uD83D\uDDD1️ Clear Worksheet Image Data"})}function eE(){let e=m().statusMessage;return(0,o.jsx)("p",{style:{whiteSpace:"pre-wrap",height:"30px"},children:e})}let eF={WorksheetViewer:(0,o.jsx)(function(){(0,r.useEffect)(()=>(window.useAddWorksheetModalIsOpenStore=j,window.usePageDraggingStore=V,window.enableFullscreen=et,window.disableFullscreen=en,window.condenseWorksheetString=ew,document.addEventListener("keydown",Z),document.addEventListener("touchstart",$),document.addEventListener("touchend",q),document.addEventListener("pointermove",Q),document.addEventListener("pointerup",ee),eR.getState().loadFromLocalStorage(),()=>{document.removeEventListener("keydown",Z),document.removeEventListener("touchstart",$),document.removeEventListener("touchend",q),document.removeEventListener("pointermove",Q),document.removeEventListener("pointerup",ee)}),[]);let{addWorksheetModalIsOpen:e}=j(),t=V(e=>e.userIsDraggingPages),n=eB(e=>e.madisonMode);return(0,o.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexShrink:0,containerType:"size",cursor:t?"ew-resize":"default",backgroundColor:n?"#ffc6f3":"white"},id:"worksheetViewerDiv",children:[(0,o.jsx)(eo,{}),(0,o.jsx)(eu,{}),e?(0,o.jsx)(D,{}):null]})},{}),SettingsPage:(0,o.jsx)(function(){let e=eB(e=>e.madisonMode),t=(0,o.jsx)(c,{buttonWidthString:"24px",iconWidthString:"14px",color:"black",onClickFunction:()=>{useSessionStateStore.getState().setCurrentPage("WorksheetViewer")},additionalStyleObject:{position:"absolute",top:"18px",right:"18px"}});return(0,o.jsxs)("div",{style:{width:"100%",height:"100%",boxSizing:"border-box",padding:"16px",backgroundColor:e?"#ffc6f3":"white",position:"relative"},children:[(0,o.jsx)("h1",{children:"Settings"}),t,(0,o.jsx)(eE,{}),(0,o.jsx)(eT,{}),(0,o.jsx)("br",{}),(0,o.jsx)(eA,{}),(0,o.jsx)("br",{}),(0,o.jsx)(eD,{}),(0,o.jsx)("br",{}),(0,o.jsx)(eP,{})]})},{})},eR=d(e=>({openStudents:[{openWorksheets:[],indexOfLastWorksheetOpen:null,type:"student",name:"Student 1",color:"green",notes:"",notesCopied:!1},{openWorksheets:[],indexOfLastWorksheetOpen:null,type:"student",name:"Student 2",color:"green",notes:"",notesCopied:!1},{openWorksheets:[],indexOfLastWorksheetOpen:null,type:"student",name:"Student 3",color:"green",notes:"",notesCopied:!1},{openWorksheets:[],indexOfLastWorksheetOpen:null,type:"other",name:"Other",color:"none"}],numberInNameOfLastStudentAdded:3,setOpenStudents:t=>{e(()=>({openStudents:t})),eR.getState().saveToLocalStorage()},deleteOpenStudent:t=>{let n=eR.getState().currentWorksheet.openStudentIndex;if(n==t&&eR.getState().setCurrentWorksheet(0,null),null!==n&&n>t){let t={...eR.getState().currentWorksheet};t.openStudentIndex=n-1,e(()=>({currentWorksheet:t}))}let o=[...eR.getState().openStudents];o.splice(t,1),e(()=>({openStudents:o})),eR.getState().saveToLocalStorage()},addOpenStudentToBottom:(t,n)=>{let o=[...eR.getState().openStudents];o.splice(o.length-1,0,{openWorksheets:[],type:"student",name:t,color:n,notes:"",notesCopied:!1}),e(()=>({openStudents:o})),eR.getState().saveToLocalStorage()},currentPage:"WorksheetViewer",setCurrentPage:t=>{e(()=>({currentPage:t})),eR.getState().saveToLocalStorage()},currentWorksheet:{openStudentIndex:0,worksheetIndex:null},setCurrentWorksheet:(t,n)=>{if(e(()=>({currentWorksheet:{openStudentIndex:t,worksheetIndex:n}})),null==n||null==t)return;let{openStudents:o,setCurrentPageOfWorksheet:r}=eR.getState(),s=o[t].openWorksheets[n].id;(void 0===S[s]||void 0===S[s].pageBlobs)&&k(s);let i=o[t].openWorksheets[n].pageLeftOff,{pageView:l}=eB.getState();"single"==l&&0==i&&(i=1),"double"==l&&i%2==1&&i--,r(i),o[t].indexOfLastWorksheetOpen=n,eR.getState().saveToLocalStorage()},getCurrentWorksheetID:()=>{let{openStudents:e,currentWorksheet:t}=eR.getState();return null!==t.openStudentIndex&&null!==t.worksheetIndex&&void 0!==e[t.openStudentIndex].openWorksheets[t.worksheetIndex]?e[t.openStudentIndex].openWorksheets[t.worksheetIndex].id:null},userIsMovingCurrentWorksheet:!1,setUserIsMovingCurrentWorksheet:t=>{e(()=>({userIsMovingCurrentWorksheet:t}))},userCanClickAnywhereToDisableMovingCurrentWorksheet:!1,setUserCanClickAnywhereToDisableMovingCurrentWorksheet:t=>{e(()=>({userCanClickAnywhereToDisableMovingCurrentWorksheet:t}))},currentPageOfWorksheet:0,setCurrentPageOfWorksheet:t=>{e(()=>({currentPageOfWorksheet:t}));let{openStudents:n,currentWorksheet:o}=eR.getState();null!==o.openStudentIndex&&null!==o.worksheetIndex&&(n[o.openStudentIndex].openWorksheets[o.worksheetIndex].pageLeftOff=t,e({openStudents:[...n]})),eR.getState().saveToLocalStorage()},allowArrowKeysForPageNavigation:!0,setAllowArrowKeysForPageNavigation:t=>{e(()=>({allowArrowKeysForPageNavigation:t}))},lastPointerInputWasTouch:!0,usePlaceholderImages:!1,saveToLocalStorage:()=>{let e=eR.getState(),t={openStudents:e.openStudents,currentPage:e.currentPage,currentWorksheet:e.currentWorksheet,currentPageOfWorksheet:e.currentPageOfWorksheet,numberInNameOfLastStudentAdded:e.numberInNameOfLastStudentAdded};localStorage.setItem("sessionState",JSON.stringify(t))},loadFromLocalStorage:()=>{let t=localStorage.getItem("sessionState");if(null!==t){let n=JSON.parse(t);e(()=>({openStudents:n.openStudents,currentPage:n.currentPage,currentWorksheet:n.currentWorksheet,currentPageOfWorksheet:n.currentPageOfWorksheet,numberInNameOfLastStudentAdded:n.numberInNameOfLastStudentAdded}));let o=eR.getState().getCurrentWorksheetID();null!=o&&k(o)}}})),eB=d(e=>({pageView:"double",setPageView:t=>{e(()=>({pageView:t}))},madisonMode:!1,setMadisonMode:t=>{e(()=>({madisonMode:t}))}}));function e_(){return 1!==window.visualViewport.scale}function ez(){e_()&&!y.getState().userHasPinchZoomed&&y.getState().setUserHasPinchZoomed(!0)}function eM(e){let t=eR.getState().lastPointerInputWasTouch;"touch"==e.pointerType&&!1==t&&eR.setState({lastPointerInputWasTouch:!0}),"mouse"==e.pointerType&&!0==t&&eR.setState({lastPointerInputWasTouch:!1})}let eN=function(){!function e(t){let n=e_();y.getState().userHasPinchZoomed!==n&&y.getState().setUserHasPinchZoomed(n),t&&setTimeout(e(!1),1e3)}(!1)},eV=function(){let{userHasPinchZoomed:e}=y(),{pageView:t}=eB();(0,r.useEffect)(()=>(window.retrieveWorksheet=k,window.worksheets=S,window.location.href.includes("?reset")&&(localStorage.removeItem("sessionState"),window.location.href=window.location.href.replace("?reset","")),window.location.href.includes("?placeholderimages")&&eR.setState({usePlaceholderImages:!0}),window.visualViewport.addEventListener("resize",ez),document.addEventListener("touchend",eN),document.addEventListener("mouseup",eN),document.addEventListener("pointerdown",eM),ez(),window.location.href.includes("?eruda")&&Promise.all([n.e(210),n.e(558)]).then(n.t.bind(n,9651,23)).then(e=>{e.default.init()}),()=>{window.visualViewport.removeEventListener("resize",ez),document.removeEventListener("touchend",eN),document.removeEventListener("mouseup",eN),document.removeEventListener("pointerdown",eM)}),[]);let s={fontFamily:"Roboto, sans-serif",fontWeight:"normal",fontSize:"18px",height:"100%",width:"100%",maxWidth:"double"==t?"1500px":"1000px",color:x.nearBlackColor,margin:"0 auto"},i=eR(e=>e.currentPage);return"WorksheetViewer"==i&&(s.touchAction=e?"auto":"pinch-zoom"),(0,r.useEffect)(()=>{window.useSessionStateStore=eR,window.useUserSettingsStore=eB,window.location.href.includes("?download")?function(){console.log("retrieveWorksheetsFromIndexedDB() called undefined"),w.getState().updateValue(!0);let e=new Worker(x.webWorkersFolderPath+"/worker_for_retrieve_files_from_idb.js"),t={idbDatabaseVersion:x.idbDatabaseVersion};e.postMessage(t),e.onmessage=function(e){if("status_update_from_web_worker"==e.data.type&&eO(e.data.content),"worksheets_from_idb"==e.data.type){for(let e in S)S.hasOwnProperty(e)&&delete S[e];Object.assign(S,e.data.content),S.keys=Object.keys(S),S.integerMap=function(){let e=Object.keys(S),t={};for(let n=0;n<e.length;n++){if("keys"==e[n]||"integerMap"==e[n])continue;let o=e[n].split(" "),r="";for(let e=0;e<o.length;e++)(o[e].includes(".")||o[e].includes("-"))&&(r+=o[e].replace(/[^0-9ABC]/g,""));t.hasOwnProperty(r)?t[r].push(e[n]):t[r]=[e[n]]}return t}();let t={};for(let e in t.keys=S.keys,t.integerMap=S.integerMap,S)"keys"!==e&&"integerMap"!==e&&(t[e]={localization:S[e].localization,is_old:S[e].is_old,pageCount:S[e].pageCount});let n=new Blob([JSON.stringify(t)],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.download="worksheets_without_page_blobs.json",r.href=o,r.click(),w.getState().updateValue(!1)}}}():b()},[]),(0,o.jsx)("div",{style:s,onClick:function(){if("WorksheetViewer"==i){let{userIsMovingCurrentWorksheet:e,userCanClickAnywhereToDisableMovingCurrentWorksheet:t}=eR.getState(),{userJustClickedMove:n}=v.getState();if(!n&&e&&t){let{setUserIsMovingCurrentWorksheet:e,setUserCanClickAnywhereToDisableMovingCurrentWorksheet:t}=eR.getState();e(!1),t(!1)}}},children:eF[i]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[721,59,358],()=>t(3479)),_N_E=e.O()}]);