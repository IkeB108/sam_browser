(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4643:(e,t,n)=>{Promise.resolve().then(n.bind(n,6363))},6363:(e,t,n)=>{"use strict";n.r(t),n.d(t,{calcUserHasPinchZoomed:()=>L,default:()=>G,useAllStudentsStore:()=>R,useSessionStateStore:()=>U,useUserSettingsStore:()=>E,worksheets:()=>T});var r=n(1047),o=n(6847);let s=e=>{let t;let n=new Set,r=(e,r)=>{let o="function"==typeof e?e(t):e;if(!Object.is(o,t)){let e=t;t=(null!=r?r:"object"!=typeof o||null===o)?o:Object.assign({},t,o),n.forEach(n=>n(t,e))}},o=()=>t,s={setState:r,getState:o,getInitialState:()=>i,subscribe:e=>(n.add(e),()=>n.delete(e))},i=t=e(r,o,s);return s},i=e=>e?s(e):s,l=e=>e,a=e=>{let t=i(e),n=e=>(function(e,t=l){let n=o.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return o.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},d=e=>e?a(e):a;function u(e){let{buttonWidthString:t,iconWidthString:n,color:o,onClickFunction:s,additionalStyleObject:i}=e,l={background:"none",border:"none",cursor:"pointer",width:t,height:t,padding:"0px",verticalAlign:"middle",display:"flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box"};return i&&Object.assign(l,i),(0,r.jsx)("button",{style:l,onClick:s,children:(0,r.jsx)("img",{src:"".concat(h.iconsFolderPath,"/close_").concat(o,".svg"),alt:"Close",style:{width:n,height:n}})})}let c="/sam_browser/out",h={softBorderColor:"#A9A09E",redColor:"#C56D61",worksheetSelectionPanelWidth:"300px",colorMap:{red:"#BD1452",orange:"#FE9350",yellow:"#FFFB79",green:"#53C162",cyan:"#70D9FF",blue:"#2D4CA8",purple:"#8B2F99",pink:"#FF9FDC"},getGenericButtonStyle:function(e){return{padding:"10px",borderRadius:"8px",cursor:"pointer",borderColor:"black",borderStyle:"solid",...{primary:{backgroundColor:"black",color:"white",border:"none"},secondary:{backgroundColor:"white",color:"black"},tertiary:{backgroundColor:"transparent",color:"black",border:"none"}}[e]}},webWorkersFolderPath:c+"/web_workers_for_ws_images",iconsFolderPath:c+"/icons",idbDatabaseVersion:1},g=d(e=>({aWorksheetProcessIsBusy:!1,updateValue:t=>{e(()=>(console.log("worksheet process is busy set to "+t),{aWorksheetProcessIsBusy:t}))}})),p=d(e=>({statusMessage:"Retrieving worksheet data from your device...",setStatusMessage:t=>{e(()=>({statusMessage:t}))}})),b=d(e=>({userHasPinchZoomed:!1,setUserHasPinchZoomed:t=>{e(()=>({userHasPinchZoomed:t}))}}));function x(){let e=g().aWorksheetProcessIsBusy,t=p().statusMessage,n=null;return n=e?(0,r.jsx)("div",{style:{display:"flex",height:"0%",flexGrow:1,backgroundColor:"lightblue"},children:(0,r.jsx)("p",{children:t})}):(0,r.jsxs)("div",{style:{display:"flex",height:"0%",flexGrow:1,backgroundColor:"lightblue"},children:[(0,r.jsx)(S,{isLeftOrRight:"left"}),(0,r.jsx)(S,{isLeftOrRight:"right"})]}),(0,r.jsxs)("div",{style:{flexGrow:1,flexBasis:"0%",height:"100%",backgroundColor:"lightgrey",padding:"16px",boxSizing:"border-box",display:"flex",flexDirection:"column"},children:[n,(0,r.jsx)(f,{})]})}function f(){let e=(0,r.jsx)("button",{onClick:()=>{U.getState().setCurrentPage("SettingsPage")},style:{padding:"5px",borderRadius:"50%",backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"18px"},children:"⚙️"});return(0,r.jsx)("div",{style:{padding:"16px"},children:e})}function S(e){let{isLeftOrRight:t}=e,n={width:"50%",height:"100%",position:"relative"};return"left"==t&&(n.marginRight="16px"),(0,r.jsxs)("div",{style:n,children:[(0,r.jsx)(w,{imageSrc:"placeholderWorksheetPage.webp"}),(0,r.jsx)(k,{isLeftOrRight:t})]})}function k(e){let{isLeftOrRight:t}=e,n={position:"absolute",bottom:"0px",padding:"20px",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"};return"left"==t?n.left="0px":n.right="0px",(0,r.jsx)("button",{style:n,className:"turn-page-button",children:"left"==t?"\uD83E\uDC60":"\uD83E\uDC62"})}function w(e){let{imageSrc:t}=e;return(0,r.jsx)("img",{src:t,style:{width:"100%",height:"100%",objectFit:"contain"}})}function m(){let e={width:h.worksheetSelectionPanelWidth,height:"100%",padding:"18px",paddingLeft:"0px",boxSizing:"border-box",overflowY:"scroll"},t=U().openStudents;return(0,o.useEffect)(()=>{window.openStudents=t},[]),(0,r.jsx)("div",{style:e,children:t.map((e,t)=>(0,r.jsx)(y,{studentIDNumber:e.studentIDNumber},e.studentIDNumber))})}function y(e){let{studentIDNumber:t}=e,{allStudents:n}=R.getState(),{openStudents:o}=U.getState(),s=n[t];return(0,r.jsxs)("div",{style:{width:"100%",backgroundColor:"white",borderRadius:"12px",boxShadow:"0px 1px 2px rgba(0, 0, 0, 0.45)",boxSizing:"border-box",marginBottom:"24px",overflow:"hidden",position:"relative"},children:[(0,r.jsx)(P,{studentName:s.name,studentIDNumber:t}),(0,r.jsx)(C,{studentIDNumber:t}),(0,r.jsx)(I,{studentIDNumber:t})]})}function j(e){let t=U.getState().openStudents;return{thisStudent:t.filter(t=>t.studentIDNumber==e)[0],thisStudentIndex:t.findIndex(t=>t.studentIDNumber==e)}}function C(e){let{studentIDNumber:t}=e,{allStudents:n}=R.getState(),{openStudents:o,currentWorksheet:s}=U(),{thisStudent:i,thisStudentIndex:l}=j(t),a=[];for(let e=0;e<i.openWorksheets.length;e++){let t=i.openWorksheets[e],n=s.openStudentIndex==l&&s.worksheetIndex==e,o=function(){U.getState().setCurrentWorksheet(l,e),U.getState().setUserIsMovingCurrentWorksheet(!1)};a.push((0,r.jsx)(v,{worksheetID:t,isCurrentWorksheet:n,onClick:o},t))}return(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",padding:"14px 14px",overflowY:"auto",height:"100%"},children:a})}function v(e){let{worksheetID:t,isCurrentWorksheet:n,onClick:o}=e,s={fontFamily:"Roboto, sans-serif",fontWeight:"normal",fontSize:"14px",border:"none",backgroundColor:"white",padding:"10px",cursor:n?"arrow":"pointer",textAlign:"left",width:"100%",borderRadius:"500px",color:"black",boxSizing:"border-box",display:"flex",justifyContent:"space-between",alignItems:"center"};return n?(s.backgroundColor="#55587B26",(0,r.jsxs)("div",{style:s,children:[(0,r.jsx)("p",{style:{margin:0,whiteSpace:n?"normal":"nowrap",overflow:"hidden",textOverflow:"ellipsis",flexShrink:1},children:t}),(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(W,{}),(0,r.jsx)(u,{buttonWidthString:"24px",iconWidthString:"14px",color:"black",onClickFunction:function(){let e=U.getState().currentWorksheet;U.getState().openStudents[e.openStudentIndex].openWorksheets.splice(e.worksheetIndex,1),U.getState().setCurrentWorksheet(null,null),U.getState().setUserIsMovingCurrentWorksheet(!1)},additionalStyleObject:{flexShrink:0}})]})]})):(0,r.jsx)("button",{style:s,onClick:o,children:t})}function W(){return(0,r.jsx)("button",{style:{background:"none",border:"none",cursor:"pointer",width:"24px",height:"24px",padding:"0px",verticalAlign:"middle",display:"flex",alignItems:"center",justifyContent:"center",margin:"0px 16px",boxSizing:"border-box",flexShrink:0},onClick:()=>{let{userIsMovingCurrentWorksheet:e,setUserIsMovingCurrentWorksheet:t,setUserCanClickAnywhereToDisableMovingCurrentWorksheet:n}=U.getState();e||(console.log("user is now moving a worksheet"),n(!0)),t(!e)},children:(0,r.jsx)("img",{src:"".concat(h.iconsFolderPath,"/move.svg"),alt:"Move Worksheet",style:{width:"20px",height:"16px"}})})}function I(e){let{studentIDNumber:t}=e,n={backgroundColor:"white",border:"2px solid ".concat(h.softBorderColor),borderRadius:"50%",cursor:"pointer",width:"40px",height:"40px",verticalAlign:"middle",display:"flex",alignItems:"center",justifyContent:"center"};return(0,r.jsxs)("div",{style:{backgroundColor:"none",padding:"14px 14px",paddingTop:"0px",justifyContent:"space-between",alignItems:"center",display:"flex"},children:[(0,r.jsx)(D,{styleObject:n,studentIDNumber:t}),(0,r.jsx)(_,{styleObject:n,studentIDNumber:t})]})}function D(e){let{studentIDNumber:t,styleObject:n}=e;return(0,r.jsx)("button",{style:n,children:(0,r.jsx)("img",{src:h.iconsFolderPath+"/timer.svg",alt:"Start timer",style:{width:"23px",height:"23px"}})})}function _(e){let{studentIDNumber:t,styleObject:n}=e;return(0,r.jsx)("button",{style:n,children:(0,r.jsx)("img",{src:h.iconsFolderPath+"/add.svg",alt:"Add worksheet",style:{width:"16px",height:"16px"}})})}function P(e){let{studentName:t,studentIDNumber:n}=e,{allStudents:o}=R.getState(),{userIsMovingCurrentWorksheet:s,openStudents:i,currentWorksheet:l}=U.getState(),a=o[n],d={display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:h.redColor,padding:"14px 14px","--original-bg-color":h.redColor,cursor:s?"pointer":"default"},c={width:"18px",height:"18px",borderRadius:"50%",backgroundColor:h.colorMap[a.color],marginRight:"10px"};return(0,r.jsxs)("div",{style:d,className:s?"pulsatingHeader":null,onClick:s?function(){console.log(i);let{thisStudentIndex:e}=j(n),{setOpenStudents:t,setCurrentWorksheet:r}=U.getState();if(e!==l.openStudentIndex){let n=[...i];n[e].openWorksheets.push(i[l.openStudentIndex].openWorksheets[l.worksheetIndex]),i[l.openStudentIndex].openWorksheets.splice(l.worksheetIndex,1),t(n),r(e,n[e].openWorksheets.length-1)}}:null,children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)("div",{style:c}),(0,r.jsxs)("h1",{style:{margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"white",fontWeight:"normal",fontSize:"1em"},children:[t," ID",n]})]}),s?null:(0,r.jsx)(u,{buttonWidthString:"24px",iconWidthString:"14px",color:"white",onClickFunction:()=>{let{deleteOpenStudent:e}=U.getState();e(n)}})]})}function A(e){p.getState().setStatusMessage(e)}function F(){let e=h.getGenericButtonStyle("primary"),t=o.useRef(null),n=g().aWorksheetProcessIsBusy,s=async function(e){if(0===e.target.files.length)return;let t=e.target.files[0];(function(e){for(let t in e){let n=t.split("_-")[0],r=Number(t.split("_-")[1].split(".")[0]);if(T[n])T[n].pageBlobs[r]=e[t].blob;else{let o={};o[r]=e[t].blob,T[n]={pageBlobs:o,is_old:t.includes("(OLD)"),localization:t.includes("(USA)")?"USA":"only",pageCount:"unknown"}}}(function(){for(let e in T)"only"==T[e].localization&&function(e){let t=e.replace(/\D/g,"");for(let e in T){let n=e.replace(/\D/g,"");if(e.includes("(USA)")&&n==t)return!0}return!1}(e)&&(T[e].localization="NON-USA"),T[e].pageCount=Object.keys(T[e].pageBlobs).length})()})(await O(t)),function(){let e=new Worker(h.webWorkersFolderPath+"/worker_for_store_files_in_idb.js"),t={worksheets:T,idbDatabaseVersion:h.idbDatabaseVersion};e.postMessage(t),e.onmessage=function(e){"status_update_from_web_worker"==e.data.type&&A(e.data.content),"confirm_transaction_complete"==e.data.type&&g.getState().updateValue(!1)},g.getState().updateValue(!0)}()};return(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{style:e,onClick:()=>{n||t.current.click()},disabled:n,className:"button-with-disabled-variant",children:"Upload Worksheet Image Data"}),(0,r.jsx)("input",{type:"file",style:{display:"none"},ref:t,accept:".tar",onChange:s})]})}async function O(e){A("Extracting images from tar file...");let t=new FileReader,n={},r=0;return new Promise((o,s)=>{t.onload=function(e){untar(t.result).then(function(e){for(let t in e){let o=e[t].name.substring(e[t].name.lastIndexOf("/")+1);if(o.includes(".webp")){let s={name:o,blob:new Blob([e[t].blob],{type:"image/webp"}),size:e[t].size};n[o]=s,r++}else console.log("File not a webp image: "+o)}A(r+" images extracted. Storing worksheets on your device..."),o(n)}).catch(s)},t.onerror=s,t.readAsArrayBuffer(e)})}function N(){let e=h.getGenericButtonStyle("primary"),t=g().aWorksheetProcessIsBusy;return(0,r.jsx)("button",{style:e,onClick:function(){t||B(!0)},disabled:t,className:"button-with-disabled-variant",children:"Retrieve Worksheet Image Data"})}function B(e){g.getState().updateValue(!0);let t=new Worker(h.webWorkersFolderPath+"/worker_for_retrieve_files_from_idb.js"),n={idbDatabaseVersion:h.idbDatabaseVersion};t.postMessage(n),t.onmessage=function(e){if("status_update_from_web_worker"==e.data.type&&A(e.data.content),"worksheets_from_idb"==e.data.type){for(let e in T)T.hasOwnProperty(e)&&delete T[e];Object.assign(T,e.data.content),window.worksheets=T,g.getState().updateValue(!1)}}}function M(){let e=h.getGenericButtonStyle("primary"),t=g().aWorksheetProcessIsBusy;return(0,r.jsx)("button",{style:e,onClick:function(){let e;t||((e=indexedDB.open("worksheetDatabase",h.idbDatabaseVersion)).onupgradeneeded=function(e){e.target.result.createObjectStore("allWorksheets")},e.onsuccess=async function(e){e.target.result.transaction("allWorksheets","readwrite").objectStore("allWorksheets").clear()},A("Worksheet image data cleared."))},disabled:t,className:"button-with-disabled-variant",children:"Clear Worksheet Image Data"})}function z(){let e=p().statusMessage;return(0,r.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:e})}let V={WorksheetViewer:(0,r.jsx)(function(){let{userHasPinchZoomed:e}=b();return(0,r.jsxs)("div",{style:{width:"100%",height:"100%",backgroundColor:e?"green":"red",display:"flex",flexShrink:0},children:[(0,r.jsx)(x,{}),(0,r.jsx)(m,{})]})},{}),SettingsPage:(0,r.jsx)(function(){let e=(0,r.jsx)(u,{buttonWidthString:"24px",iconWidthString:"14px",color:"black",onClickFunction:()=>{useSessionStateStore.getState().setCurrentPage("WorksheetViewer")},additionalStyleObject:{position:"absolute",top:"18px",right:"18px"}});return(0,r.jsxs)("div",{style:{width:"100%",height:"100%",boxSizing:"border-box",padding:"18px"},children:[(0,r.jsx)("h1",{children:"Settings"}),e,(0,r.jsx)(F,{}),(0,r.jsx)("br",{}),(0,r.jsx)(N,{}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)(M,{}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)(z,{})]})},{})},R=d(function(e){let t=function(){let e=localStorage.getItem("allStudents");return null!==e?(console.log("Found allStudents in local storage."),{allStudents:JSON.parse(e)}):(console.log("Didn't find allStudents in local storage."),{allStudents:{}})};return{allStudents:{},initAllStudents:()=>{e(t)},setAllStudents:t=>{e({allStudents:t})}}});R.getState().setAllStudents({1:{name:"Bill",color:"red"},2:{name:"Ted",color:"green"},3:{name:"Alice",color:"blue"}});let U=d(e=>({openStudents:[{openWorksheets:["(OLD) 03.01-05 HF (USA) 1-1 WS","(OLD) 3.02 C10000 (USA) 1-1 WS"],studentIDNumber:"1"},{openWorksheets:[],studentIDNumber:"2"}],setOpenStudents:t=>{e(()=>({openStudents:t}))},deleteOpenStudent:t=>{let n=U.getState().openStudents.filter(e=>e.studentIDNumber!==t);e(()=>({openStudents:n}))},addOpenStudentToBottom:t=>{let n=U.getState().openStudents.concat({openWorksheets:[],studentIDNumber:t});e(()=>({openStudents:n}))},currentPage:"WorksheetViewer",setCurrentPage:t=>{e(()=>({currentPage:t}))},currentWorksheet:{openStudentIndex:null,worksheetIndex:null},setCurrentWorksheet:(t,n)=>{e(()=>({currentWorksheet:{openStudentIndex:t,worksheetIndex:n}}))},userIsMovingCurrentWorksheet:!1,setUserIsMovingCurrentWorksheet:t=>{e(()=>({userIsMovingCurrentWorksheet:t}))},userCanClickAnywhereToDisableMovingCurrentWorksheet:!1,setUserCanClickAnywhereToDisableMovingCurrentWorksheet:t=>{e(()=>({userCanClickAnywhereToDisableMovingCurrentWorksheet:t}))}})),E=d(e=>({}));function L(){return 1!==window.visualViewport.scale}function H(){L()&&!b.getState().userHasPinchZoomed&&b.getState().setUserHasPinchZoomed(!0)}let T={},Z=function(){let e=L();b.getState().userHasPinchZoomed!==e&&b.getState().setUserHasPinchZoomed(e)},G=function(){let{userHasPinchZoomed:e}=b();(0,o.useEffect)(()=>(window.visualViewport.addEventListener("resize",H),document.addEventListener("touchend",Z),document.addEventListener("mouseup",Z),H(),()=>{window.visualViewport.removeEventListener("resize",H),document.removeEventListener("touchend",Z),document.removeEventListener("mouseup",Z)}),[]);let t=U(),n=t.currentPage;return(0,o.useEffect)(()=>{window.useAllStudentsStore=R,window.useSessionStateStore=U,B()},[]),(0,r.jsx)("div",{style:{fontFamily:"Roboto, sans-serif",fontWeight:"normal",fontSize:"18px",height:"100%",width:"100%",touchAction:e?"auto":"pinch-zoom"},onClick:function(){"WorksheetViewer"==n&&t.userIsMovingCurrentWorksheet&&t.userCanClickAnywhereToDisableMovingCurrentWorksheet&&(console.log("is called"),t.setUserIsMovingCurrentWorksheet(!1),t.setUserCanClickAnywhereToDisableMovingCurrentWorksheet(!1))},children:V[n]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[721,59,358],()=>t(4643)),_N_E=e.O()}]);