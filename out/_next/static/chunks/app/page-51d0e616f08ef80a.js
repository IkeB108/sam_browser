(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4643:(e,t,n)=>{Promise.resolve().then(n.bind(n,2490))},2490:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>z,useAllStudentsStore:()=>W,useSessionStateStore:()=>v,useUserSettingsStore:()=>O,worksheetImages:()=>B,worksheets:()=>N});var r=n(1047),s=n(6847);let o=e=>{let t;let n=new Set,r=(e,r)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=r?r:"object"!=typeof s||null===s)?s:Object.assign({},t,s),n.forEach(n=>n(t,e))}},s=()=>t,o={setState:r,getState:s,getInitialState:()=>i,subscribe:e=>(n.add(e),()=>n.delete(e))},i=t=e(r,s,o);return o},i=e=>e?o(e):o,l=e=>e,a=e=>{let t=i(e),n=e=>(function(e,t=l){let n=s.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return s.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},d=e=>e?a(e):a,u={red:"#B90000",orange:"#E15E00",yellow:"#D4D300",green:"#2D8B1E",cyan:"#0DB6B3",blue:"#0d22b6",purple:"#7e069d",pink:"#da2bb9"};for(let e in u)u[e]={standard:u[e],light:u[e]+"55"};let c={panelPadding:"6px",pagePadding:"18px",worksheetSelectionPanelWidth:"300px",colorMap:u,getGenericButtonStyle:function(e){return{padding:"10px",borderRadius:"8px",cursor:"pointer",borderColor:"black",borderStyle:"solid",...{primary:{backgroundColor:"black",color:"white",border:"none"},secondary:{backgroundColor:"white",color:"black"},tertiary:{backgroundColor:"transparent",color:"black",border:"none"}}[e]}},CloseButton:function(e,t){return(0,r.jsx)("button",{style:{position:"absolute",top:e,right:e,backgroundColor:"transparent",border:"none",cursor:"pointer",width:"40px",height:"40px",fontSize:"30px",color:"black"},onClick:t,children:"\xd7"})},webWorkersFolderPath:"/sam_browser/out/web_workers_for_ws_images",idbDatabaseVersion:1};function g(){let e={flexGrow:1,flexBasis:"0%",height:"100%",backgroundColor:"lightgrey",padding:c.panelPadding,boxSizing:"border-box",display:"flex",flexDirection:"column"};return(0,r.jsxs)("div",{style:e,children:[(0,r.jsxs)("div",{style:{display:"flex",height:"0%",flexGrow:1,backgroundColor:"lightblue"},children:[(0,r.jsx)(p,{isLeftOrRight:"left"}),(0,r.jsx)(p,{isLeftOrRight:"right"})]}),(0,r.jsx)(b,{})]})}function b(){let e={padding:c.panelPadding},t=(0,r.jsx)("button",{onClick:()=>{v.getState().setCurrentPage("SettingsPage")},style:{padding:"5px",borderRadius:"50%",backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"20px"},children:"⚙️"});return(0,r.jsx)("div",{style:e,children:t})}function p(e){let{isLeftOrRight:t}=e,n={width:"50%",height:"100%",position:"relative"};return"left"==t&&(n.marginRight=c.panelPadding),(0,r.jsxs)("div",{style:n,children:[(0,r.jsx)(f,{imageSrc:"placeholderWorksheetPage.webp"}),(0,r.jsx)(h,{isLeftOrRight:t})]})}function h(e){let{isLeftOrRight:t}=e,n={position:"absolute",bottom:"0px",padding:"20px",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"};return"left"==t?n.left="0px":n.right="0px",(0,r.jsx)("button",{style:n,className:"turn-page-button",children:"left"==t?"\uD83E\uDC60":"\uD83E\uDC62"})}function f(e){let{imageSrc:t}=e;return(0,r.jsx)("img",{src:t,style:{width:"100%",height:"100%",objectFit:"contain"}})}function S(){let e={width:c.worksheetSelectionPanelWidth,height:"100%",padding:c.panelPadding,boxSizing:"border-box"},t=v().openStudents;return(0,r.jsx)("div",{style:e,children:t.map((e,t)=>(0,r.jsx)(x,{studentIDNumber:e.studentIDNumber},e.studentIDNumber))})}function x(e){let{studentIDNumber:t}=e,{allStudents:n}=W.getState(),{openStudents:s}=v.getState(),o=n[t],i={width:"100%",backgroundColor:c.colorMap[o.color].light,padding:c.panelPadding,boxSizing:"border-box",marginBottom:c.panelPadding};return(0,r.jsx)("div",{style:i,children:(0,r.jsx)(w,{studentName:o.name,studentIDNumber:t})})}function w(e){let{studentName:t,studentIDNumber:n}=e;return(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("h1",{style:{margin:0,fontSize:"medium",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t," ID",n]}),(0,r.jsx)("button",{style:{background:"none",border:"none",cursor:"pointer",fontSize:"large",color:"black"},onClick:()=>{let{deleteOpenStudent:e}=v.getState();e(n)},children:"\xd7"})]})}let k=d(e=>({userIsUploadingWorksheetImages:!1,updateValue:t=>{e(()=>(console.log("uploading value set to "+t),{userIsUploadingWorksheetImages:t}))}})),m=d(e=>({statusMessage:"Waiting for file input.",setStatusMessage:t=>{e(()=>({statusMessage:t}))}}));function y(e){m.getState().setStatusMessage(e)}function j(){let e=c.getGenericButtonStyle("primary"),t=s.useRef(null),n=async function(e){if(0===e.target.files.length)return;let t=e.target.files[0];(function(e){for(let t in e){let n=t.split("_-")[0],r=Number(t.split("_-")[1].split(".")[0]);if(N[n])N[n].pageBlobs[r]=e[t].blob;else{let s={};s[r]=e[t].blob,N[n]={pageBlobs:s,is_old:t.includes("(OLD)"),localization:t.includes("(USA)")?"USA":"only",pageCount:"unknown"}}}(function(){for(let e in N)"only"==N[e].localization&&function(e){let t=e.replace(/\D/g,"");for(let e in N){let n=e.replace(/\D/g,"");if(e.includes("(USA)")&&n==t)return!0}return!1}(e)&&(N[e].localization="NON-USA"),N[e].pageCount=Object.keys(N[e].pageBlobs).length})()})(await _(t)),function(){let e=new Worker(c.webWorkersFolderPath+"/worker_for_store_files_in_idb.js"),t={worksheets:N,idbDatabaseVersion:c.idbDatabaseVersion};e.postMessage(t),e.onmessage=function(e){"status_update_from_web_worker"==e.data.type&&y(e.data.content),"confirm_transaction_complete"==e.data.type&&k.getState().updateValue(!1)},k.getState().updateValue(!0)}()};return(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{style:e,onClick:()=>{t.current.click()},children:"Upload Worksheet Image Data"}),(0,r.jsx)("input",{type:"file",style:{display:"none"},ref:t,accept:".tar",onChange:n})]})}async function _(e){y("Extracting images from tar file...");let t=new FileReader,n={},r=0;return new Promise((s,o)=>{t.onload=function(e){untar(t.result).then(function(e){for(let t in e){let s=e[t].name.substring(e[t].name.lastIndexOf("/")+1);if(s.includes(".webp")){let o={name:s,blob:new Blob([e[t].blob],{type:"image/webp"}),size:e[t].size};n[s]=o,r++}else console.log("File not a webp image: "+s)}y(r+" images extracted."),s(n)}).catch(o)},t.onerror=o,t.readAsArrayBuffer(e)})}function D(){let e=c.getGenericButtonStyle("primary"),t=k().userIsUploadingWorksheetImages;return(0,r.jsx)("button",{style:e,onClick:function(){t||function(){let e=new Worker(c.webWorkersFolderPath+"/worker_for_retrieve_files_from_idb.js"),t={idbDatabaseVersion:c.idbDatabaseVersion};e.postMessage(t),e.onmessage=function(e){if("status_update_from_web_worker"==e.data.type&&y(e.data.content),"worksheets_from_idb"==e.data.type){for(let e in N)N.hasOwnProperty(e)&&delete N[e];Object.assign(N,e.data.content),window.worksheets=N}}}()},disabled:t,className:"button-with-disabled-variant",children:"Retrieve Worksheet Image Data"})}function C(){let e=c.getGenericButtonStyle("primary"),t=k().userIsUploadingWorksheetImages;return(0,r.jsx)("button",{style:e,onClick:function(){let e;t||((e=indexedDB.open("worksheetDatabase",c.idbDatabaseVersion)).onupgradeneeded=function(e){e.target.result.createObjectStore("allWorksheets")},e.onsuccess=async function(e){e.target.result.transaction("allWorksheets","readwrite").objectStore("allWorksheets").clear()})},disabled:t,className:"button-with-disabled-variant",children:"Clear Worksheet Image Data"})}function P(){let e=m().statusMessage;return(0,r.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:e})}let I={WorksheetViewer:(0,r.jsx)(function(){return(0,r.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexShrink:0},children:[(0,r.jsx)(g,{}),(0,r.jsx)(S,{})]})},{}),SettingsPage:(0,r.jsx)(function(){let e={width:"100%",height:"100%",boxSizing:"border-box",padding:c.pagePadding};return(0,r.jsxs)("div",{style:e,children:[(0,r.jsx)("h1",{children:"Settings"}),c.CloseButton(c.pagePadding,()=>{useSessionStateStore.getState().setCurrentPage("WorksheetViewer")}),(0,r.jsx)(j,{}),(0,r.jsx)("br",{}),(0,r.jsx)(D,{}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)(C,{}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)("button",{onClick:()=>{statusMessageStore.setStatusMessage(typeof untar)},children:"Test Untar"}),(0,r.jsx)(P,{})]})},{})},W=d(function(e){let t=function(){let e=localStorage.getItem("allStudents");return null!==e?(console.log("Found allStudents in local storage."),{allStudents:JSON.parse(e)}):(console.log("Didn't find allStudents in local storage."),{allStudents:{}})};return{allStudents:{},initAllStudents:()=>{e(t)},setAllStudents:t=>{e({allStudents:t})}}});W.getState().setAllStudents({1:{name:"Bill",color:"red"},2:{name:"Ted",color:"green"},3:{name:"Alice",color:"blue"}});let v=d(e=>({openStudents:[{openWorksheets:[],studentIDNumber:"1"},{openWorksheets:[],studentIDNumber:"2"}],setOpenStudents:t=>{e(()=>({openStudents:t}))},deleteOpenStudent:t=>{let n=v.getState().openStudents.filter(e=>e.studentIDNumber!==t);e(()=>({openStudents:n}))},addOpenStudentToBottom:t=>{let n=v.getState().openStudents.concat({openWorksheets:[],studentIDNumber:t});e(()=>({openStudents:n}))},currentPage:"WorksheetViewer",setCurrentPage:t=>{e(()=>({currentPage:t}))}})),O=d(e=>({})),B={},N={},z=function(){let e=v().currentPage;return(0,s.useEffect)(()=>{window.useAllStudentsStore=W,window.useSessionStateStore=v},[]),(0,r.jsx)("div",{style:{fontFamily:"Arial, sans-serif",height:"100%",width:"100%"},children:I[e]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[721,59,358],()=>t(4643)),_N_E=e.O()}]);